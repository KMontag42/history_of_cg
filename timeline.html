<!DOCTYPE html>
<html>
    <head>
        <title>Timeline</title>
        <script src="js/jquery-1.6.2.min.js"></script>
        <script src="js/raphael-min.js"></script>
    </head>

    <body>

        <script>
            var timelineX = 10; 
            var timelineY = 100;
            var timelineWidth = 800;
            var zoomLevel = 0;
            
            var canvasX = 0;
            var canvasY = 50;
            var canvasWidth = timelineWidth + timelineX*2;
            var canvasHeight= 200;
            
            var entryNum = 40;
            var entries = new Array();
            
            var baseYear = 1960;
            var endYear = 2000;
            
            var canvas;
            var context;
            
            window.onload = function() {
                // Set up the canvas
                canvas = Raphael(canvasX, canvasY, canvasWidth, canvasHeight)
                
                drawLine();
                
                // Initialize the drawing information for every entry
                var c;
                for(var i=0; i<entryNum; i++) {
                    entries[i] = {
                        name: "Circle " + i, 
                        year: 1960 + i,
                        month: Math.floor(Math.random() * 12), 
                        day: Math.floor(Math.random() * 31),
                        x: 0,
                        y: timelineY, 
                        origX: 0, 
                        radius: 5, 
                        color: "#000000"
                    };
                    setXPos(entries[i]);
                    //console.log('Entry ' + i + ' x-position is ' + entries[i].x + ' with year ' + entries[i].year + ' and month ' + entries[i].month); 
                }
                
                drawEntries();
                    
            }
            
            // Clears the canvas and redraws the timeline
            function clearCanvas() {
                canvas.clear();
                drawLine();
            }
            
            // Draws the timeline
            function drawLine() {
                canvas.rect(timelineX, timelineY, 800, 1);
            }   
            
            // Draws every entry based on pre-determined position, radius and color
            function drawEntries() {
                var c;
                for(var i=0; i<entryNum; i++) {
                    c = canvas.circle(entries[i].x, entries[i].y, entries[i].radius);
                    c.attr("fill", entries[i].color);
                    c.id = i;
                    
                    c.hover(function() {
                            this.attr({"fill": "#654", "r": entries[this.id].radius + 5});
                            console.log(entries[this.id].name + ", " + (entries[this.id].month + 1) + "/" + (entries[this.id].day + 1) + "/" + entries[this.id].year);
                        },
                        function () {
                            this.attr({"fill": "#000", "r": entries[this.id].radius});

                        }
                    );
                }
            }
            
            // Sets the initial x position of the given entry
            function setXPos(entry) {
                var yearRange = timelineWidth/(endYear - baseYear) * (1+zoomLevel);
                var monthRange = yearRange/12 * (1+zoomLevel);
                var basePos = timelineX + yearRange * (entry.year - baseYear) + monthRange * entry.month;
                entry.x = basePos - (timelineWidth * zoomLevel);
                entry.origX = entry.x;
            }
            
            // Moves every entry left
            function moveLeft() {
                if(entries[entryNum-1].x <= canvasWidth) 
                    return;
                
                clearCanvas();
                
                for(var i=0; i<entryNum; i++) {
                    entries[i].x -= 50;
                }
                
                drawEntries();
            }
            
            // Moves every entry right
            function moveRight() {
                if(entries[0].x >= 0)
                    return;
                
                clearCanvas();
                
                for(var i=0; i<entryNum; i++) {
                    entries[i].x += 50;
                }
                
                drawEntries();
            }
            
            // Zooms in on the entries
            function zoomIn() {
                if(zoomLevel  == 1) 
                    return;
                zoomLevel += .25;
                clearCanvas();
                for(var i=0; i<entryNum; i++) {
                    setXPos(entries[i])
                }
                
                drawEntries();
            }
            
            // Zooms out on the entries
            function zoomOut() {
                if(zoomLevel == 0)
                    return;
                zoomLevel -= .25;
                clearCanvas();
                
                for(var i=0; i<entryNum; i++) {
                    setXPos(entries[i])
                }
                
                drawEntries();
            }
            
        </script>
        
        <button type="button" id="moveLeft" onclick = "moveLeft()"> &#60 </button>
        <button type="button" id="moveRight" onclick = "moveRight()"> &#62 </button>
        <br />
        <button type="button" id="zoomIn" onclick = "zoomIn()"> &#43 </button>
        <button type="button" id="zoomOut" onclick = "zoomOut()"> &#45 </button>


    </body>
</html>

